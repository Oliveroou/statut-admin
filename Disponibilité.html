<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<title>Disponibilité Juin 2025 - Tech N3 & N4</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
<style>
  body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background-color: #f9f9f9;
    margin: 0; padding: 0;
  }
  header {
    display: flex; align-items: center; justify-content: center;
    padding: 30px 20px 10px; background-color: white; border-bottom: 2px solid #ddd; position: relative;
  }
  header img {
    height: 60px; position: absolute; left: 20px;
  }
  h1 {
    margin-top: 10px; font-size: 28px; color: #333; margin-left: 0; text-align: center; width: 100%; pointer-events: none;
  }
  .calendar {
    display: grid;
    grid-template-columns: repeat(6, 1fr); /* 6 colonnes Lundi-Samedi */
    gap: 1px;
    background: #ccc;
    max-width: 1000px;
    margin: 30px auto;
    border: 1px solid #ccc;
  }
  .day, .header {
    background: white; /* Fond blanc simple */
    padding: 10px;
    min-height: 100px;
    border: 1px solid #ddd;
    box-sizing: border-box;
    text-align: center;
  }
  .header {
    font-weight: bold;
    background: #f4f4f4;
  }
  .day span:first-child {
    display: block;
    font-weight: bold;
    margin-bottom: 8px;
    font-size: 18px;
    color: #444;
  }
  /* Légende couleurs */
  .legend {
    max-width: 1000px;
    margin: 20px auto;
    display: flex;
    justify-content: center;
    gap: 30px;
  }
  .legend-item {
    display: flex;
    align-items: center;
    gap: 8px;
    font-weight: bold;
    font-size: 16px;
    color: #333;
  }
  .color-box {
    width: 20px;
    height: 20px;
    border-radius: 4px;
  }
  .green { background-color: #28a745; }
  .yellow { background-color: #ffc107; }
  .red { background-color: #dc3545; }

  /* Texte des chiffres dans le jour */
  .count-n3 { color: #007bff; font-weight: bold; }
  .count-n4 { color: #17a2b8; font-weight: bold; }

  footer {
    text-align: center;
    padding: 20px;
    font-size: 14px;
    color: #777;
  }
</style>
</head>
<body>

<header>
  <img src="https://upload.wikimedia.org/wikipedia/commons/4/4b/Bravo_telecom_logo.png" alt="Bravo Telecom Logo" />
  <h1>Disponibilité -Tech N3 & N4 Juin 2025</h1>
</header>

<div class="calendar" id="calendar"></div>

<div class="legend">
  <div class="legend-item"><div class="color-box green"></div> ≤ 2 (Vert)</div>
  <div class="legend-item"><div class="color-box yellow"></div> Entre 3 et 4 (Jaune)</div>
  <div class="legend-item"><div class="color-box red"></div> ≥ 5 (Rouge)</div>
</div>

<footer>
  <div id="update-info"></div>
  &copy; 2025 Bravo Telecom - Calendar Dashboard N3/N4
</footer>

<script>
  const urlN3 = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSYg2w4YilJ0DPZF9bWsg_OiDt_XXJQGo53atPSEejUSi3xo9wbcfPSaM59ELl-R1ynm_CLXShP4NRs/pub?gid=188402740&single=true&output=csv";
  const urlN4 = "https://docs.google.com/spreadsheets/d/e/2PACX-1vR9caHFwMRkG9_70cLBfQONypOO1L1buWVD9Irq5g1pmxRwqj3WEwF97EQGO6NFBmwLUcApgLL5Cjxv/pub?gid=972554907&single=true&output=csv";

  function loadData() {
    Promise.all([
      fetch(urlN3).then(r => r.text()),
      fetch(urlN4).then(r => r.text())
    ]).then(([textN3, textN4]) => {
      const dataN3 = Papa.parse(textN3, { header: false }).data;
      const dataN4 = Papa.parse(textN4, { header: false }).data;

      const countsN3 = countDates(dataN3, 5, '-');
      const countsN4 = countDates(dataN4, 7, '-');

      renderCalendar(2025, 5, countsN3, countsN4);
      document.getElementById("update-info").textContent = "Dernière mise à jour : " + new Date().toLocaleTimeString();
    }).catch(err => {
      console.error('Erreur chargement données:', err);
      document.getElementById("update-info").textContent = "Erreur lors du chargement des données";
    });
  }

  loadData();
  setInterval(loadData, 1000);

  function countDates(data, colIndex, sep='-') {
    const counts = {};
    for (let i = 1; i < data.length; i++) {
      const row = data[i];
      if (!row || row.length <= colIndex) continue;
      let val = (row[colIndex] || '').toString().trim().replace(/"/g, '');
      if (!val.includes(sep)) continue;
      let parts = val.split(sep);
      if (parts.length !== 3) continue;
      const [dd, mm, yyyy] = parts;
      if (mm === '06' && yyyy === '2025') {
        const day = parseInt(dd, 10);
        counts[day] = (counts[day] || 0) + 1;
      }
    }
    return counts;
  }

  function renderCalendar(year, monthIndex, n3Data, n4Data) {
    const container = document.getElementById("calendar");
    container.innerHTML = '';

    const daysOfWeek = ['Lundi', 'Mardi', 'Mercredi', 'Jeudi', 'Vendredi', 'Samedi'];
    daysOfWeek.forEach(day => {
      const div = document.createElement('div');
      div.className = 'header';
      div.textContent = day;
      container.appendChild(div);
    });

    const firstDay = new Date(year, monthIndex, 1);
    const totalDays = new Date(year, monthIndex + 1, 0).getDate();

    const startOffset = firstDay.getDay() === 0 ? 6 : firstDay.getDay() -1;

    for(let i=0; i < startOffset; i++) {
      const emptyDiv = document.createElement('div');
      emptyDiv.className = 'day';
      container.appendChild(emptyDiv);
    }

    for(let day=1; day <= totalDays; day++) {
      const date = new Date(year, monthIndex, day);
      if (date.getDay() === 0) continue;

      const div = document.createElement('div');
      div.className = 'day';

      const n3 = n3Data[day] || 0;
      const n4 = n4Data[day] || 0;

      div.innerHTML = `<span>${day}</span>
        <span class="count-n3">N3 = ${n3}</span><br>
        <span class="count-n4">N4 = ${n4}</span>`;

      container.appendChild(div);
    }
  }
</script>

</body>
</html>
