<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>June 2025 Calendar - N3 & N4</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    h1 { text-align: center; }
    .calendar {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 1px;
      background: #ccc;
      max-width: 800px;
      margin: auto;
    }
    .day, .header {
      background: white;
      padding: 10px;
      min-height: 80px;
      border: 1px solid #ddd;
      box-sizing: border-box;
    }
    .header {
      font-weight: bold;
      text-align: center;
      background: #f4f4f4;
    }
    .day span {
      display: block;
      font-weight: bold;
      margin-bottom: 5px;
    }
    .day[data-has="true"] {
      background-color: #e8faff;
    }
    .green { color: green; font-weight: bold; }
    .yellow { color: orange; font-weight: bold; }
    .red { color: red; font-weight: bold; }
  </style>
</head>
<body>

<h1>June 2025 Calendar</h1>
<div class="calendar" id="calendar"></div>

<script>
const urlN3 = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSYg2w4YilJ0DPZF9bWsg_OiDt_XXJQGo53atPSEejUSi3xo9wbcfPSaM59ELl-R1ynm_CLXShP4NRs/pub?gid=188402740&single=true&output=csv";
const urlN4 = "https://docs.google.com/spreadsheets/d/e/2PACX-1vR9caHFwMRkG9_70cLBfQONypOO1L1buWVD9Irq5g1pmxRwqj3WEwF97EQGO6NFBmwLUcApgLL5Cjxv/pub?gid=972554907&single=true&output=csv";

Promise.all([
  fetch(urlN3).then(r => r.text()),
  fetch(urlN4).then(r => r.text())
]).then(([textN3, textN4]) => {
  const dataN3 = Papa.parse(textN3, { header: false }).data;
  const dataN4 = Papa.parse(textN4, { header: false }).data;

  const countsN3 = countDatesProper(dataN3, 5, '-'); // Column F = index 5
  const countsN4 = countDatesProper(dataN4, 7, '-'); // Column H = index 7

  renderCalendar(2025, 5, countsN3, countsN4); // 5 = Juin (0 = Janvier)
});

function countDatesProper(data, columnIndex, sep = '-') {
  const counts = {};
  for (let i = 1; i < data.length; i++) {
    const row = data[i];
    if (!row || row.length <= columnIndex) continue;

    let value = (row[columnIndex] || '').toString().trim().replace(/"/g, '');
    if (!value.includes('-') && !value.includes('/')) continue;

    let parts = value.includes('-') ? value.split('-') : value.split('/');
    if (parts.length !== 3) continue;

    const [dd, mm, yyyy] = parts;
    if (mm === '06' && yyyy === '2025') {
      const day = parseInt(dd, 10);
      counts[day] = (counts[day] || 0) + 1;
    }
  }
  return counts;
}

function renderCalendar(year, monthIndex, n3Data, n4Data) {
  const container = document.getElementById("calendar");
  container.innerHTML = '';

  const daysOfWeek = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
  daysOfWeek.forEach(day => {
    const div = document.createElement('div');
    div.className = 'header';
    div.textContent = day;
    container.appendChild(div);
  });

  const firstDay = new Date(year, monthIndex, 1);
  const totalDays = new Date(year, monthIndex + 1, 0).getDate();
  const startOffset = firstDay.getDay();

  for (let i = 0; i < startOffset; i++) {
    container.appendChild(document.createElement('div')).className = 'day';
  }

  for (let day = 1; day <= totalDays; day++) {
    const div = document.createElement('div');
    div.className = 'day';
    const n3 = n3Data[day] || 0;
    const n4 = n4Data[day] || 0;

    let n3Class = '';
    if (n3 <= 2) n3Class = 'green';
    else if (n3 <= 4) n3Class = 'yellow';
    else n3Class = 'red';

    let n4Class = '';
    if (n4 <= 2) n4Class = 'green';
    else if (n4 <= 4) n4Class = 'yellow';
    else n4Class = 'red';

    div.dataset.has = (n3 > 0 || n4 > 0) ? "true" : "false";
    div.innerHTML = `
      <span>${day}</span>
      <span class="${n3Class}">n3 = ${n3}</span><br>
      <span class="${n4Class}">n4 = ${n4}</span><br>
    `;
    container.appendChild(div);
  }
}
</script>

</body>
</html>
